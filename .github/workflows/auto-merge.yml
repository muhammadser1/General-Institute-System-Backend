name: Auto Merge to Develop

on:
  # Only trigger when PR is ready and tests are complete
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]
    branches: [develop]

jobs:
  auto-merge:
    name: Auto Merge to Develop Branch
    runs-on: ubuntu-latest

    # Run only if:
    # - The PR targets 'develop'
    # - Itâ€™s not a draft
    # - All required checks have passed
    if: |
      github.event.pull_request &&
      github.event.pull_request.base.ref == 'develop' &&
      github.event.pull_request.draft == false &&
      (
        startsWith(github.event.pull_request.head.ref, 'feature/') ||
        startsWith(github.event.pull_request.head.ref, 'bugfix/') ||
        contains(github.event.pull_request.labels.*.name, 'automerge')
      )

    permissions:
      contents: write
      pull-requests: write

    steps:
    - name: ðŸš€ Enable auto-merge (squash)
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        echo "Enabling auto-merge for PR #${{ github.event.pull_request.number }}"
        gh pr merge --auto --squash ${{ github.event.pull_request.number }} --repo ${{ github.repository }}
